# ğŸš€ Makeoo AWS ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£

Serverless Framework ã‚’ä½¿ç”¨ã—ã¦ AWS ä¸Šã« Makeoo ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹ãŸã‚ã®ã‚¤ãƒ³ãƒ•ãƒ©æ§‹æˆã§ã™ã€‚

## ğŸ“‹ æ¦‚è¦

- **é™çš„ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°**: S3 + CloudFront
- **ã‚³ã‚¹ãƒˆæœ€é©åŒ–**: AWS ç„¡æ–™æ å†…ã§ã®é‹ç”¨
- **ã‚°ãƒ­ãƒ¼ãƒãƒ«é…ä¿¡**: CloudFront CDN ã«ã‚ˆã‚‹é«˜é€Ÿé…ä¿¡
- **HTTPS å¯¾å¿œ**: AWS æä¾›ã® SSL è¨¼æ˜æ›¸ã‚’ä½¿ç”¨
- **SPA å¯¾å¿œ**: React Router ã®å±¥æ­´ API ã‚’ã‚µãƒãƒ¼ãƒˆ

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ãƒ¦ãƒ¼ã‚¶ãƒ¼      â”‚â”€â”€â”€â”€â”‚  CloudFront      â”‚â”€â”€â”€â”€â”‚  S3 Bucket      â”‚
â”‚   (ãƒ–ãƒ©ã‚¦ã‚¶)    â”‚    â”‚  (CDN/HTTPS)     â”‚    â”‚  (é™çš„ãƒ•ã‚¡ã‚¤ãƒ«) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚  Route53 (å°†æ¥)  â”‚
                       â”‚  (ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³)â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä½¿ç”¨ AWS ã‚µãƒ¼ãƒ“ã‚¹

| ã‚µãƒ¼ãƒ“ã‚¹       | ç”¨é€”                   | èª²é‡‘                 |
| -------------- | ---------------------- | -------------------- |
| **S3**         | é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ | ç„¡æ–™æ : 5GB          |
| **CloudFront** | CDNãƒ»HTTPS é…ä¿¡        | ç„¡æ–™æ : 50GB è»¢é€/æœˆ |
| **Route53**    | DNSï¼ˆå°†æ¥çš„ï¼‰          | æœ‰æ–™ï¼ˆæœªå®Ÿè£…ï¼‰       |

## ğŸ› ï¸ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### å‰ææ¡ä»¶

1. **AWS CLI** ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨è¨­å®š

```bash
# AWS CLI ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
unzip awscliv2.zip
sudo ./aws/install

# ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«è¨­å®š
aws configure --profile shota
```

2. **Serverless Framework** ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install -g serverless
```

3. **ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**

```bash
cd infra
npm install
```

## ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤

### ç°¡å˜ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# é–‹ç™ºç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤
./scripts/deploy.sh deploy dev

# æœ¬ç•ªç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤
./scripts/deploy.sh deploy prod
```

### è©³ç´°ãªãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

#### 1. é–‹ç™ºç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤

```bash
cd infra

# ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ“ãƒ«ãƒ‰ & ãƒ‡ãƒ—ãƒ­ã‚¤
npm run deploy:dev
```

#### 2. æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤

```bash
cd infra

# æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤
npm run deploy:prod
```

### ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã®ç¢ºèª

```bash
# ãƒ‡ãƒ—ãƒ­ã‚¤æƒ…å ±è¡¨ç¤º
./scripts/deploy.sh info dev

# ã¾ãŸã¯
cd infra && npm run info
```

ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†å¾Œã€ä»¥ä¸‹ã®æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š

- **S3 Website URL**: S3 ã®é™çš„ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆ URL
- **CloudFront URL**: `https://xxxxxxxxx.cloudfront.net` å½¢å¼ã®é…ä¿¡ URL

## ğŸ”§ æ—¥å¸¸é‹ç”¨

### ãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°æ™‚ã®æ‰‹é †

```bash
# 1. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’ãƒ“ãƒ«ãƒ‰
./scripts/deploy.sh build

# 2. S3 ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åŒæœŸ
./scripts/deploy.sh sync dev

# 3. CloudFront ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç„¡åŠ¹åŒ–
./scripts/deploy.sh invalidate dev
```

### ä¾¿åˆ©ãªã‚³ãƒãƒ³ãƒ‰

```bash
# åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰è¡¨ç¤º
./scripts/deploy.sh help

# ãƒªã‚½ãƒ¼ã‚¹è©³ç´°æƒ…å ±è¡¨ç¤º
./scripts/deploy.sh info dev

# S3 ã®ã¿ãƒ•ã‚¡ã‚¤ãƒ«åŒæœŸ
./scripts/deploy.sh sync dev

# CloudFront ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
./scripts/deploy.sh invalidate dev
```

## ğŸ—‘ï¸ ãƒªã‚½ãƒ¼ã‚¹å‰Šé™¤

âš ï¸ **æ³¨æ„**: ã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚

```bash
# é–‹ç™ºç’°å¢ƒå‰Šé™¤
./scripts/deploy.sh remove dev

# æœ¬ç•ªç’°å¢ƒå‰Šé™¤
./scripts/deploy.sh remove prod
```

## ğŸ’° ã‚³ã‚¹ãƒˆæœ€é©åŒ–

### ç„¡æ–™æ å†…ã§ã®é‹ç”¨

- **S3**: 5GB ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã€2 ä¸‡å› GET ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/æœˆ
- **CloudFront**: 50GB ãƒ‡ãƒ¼ã‚¿è»¢é€ã€200 ä¸‡å›ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/æœˆ
- **Lambda@Edge**: 100 ä¸‡å›ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/æœˆ

### è¨­å®šå†…å®¹

- CloudFront ã¯æœ€å®‰ä¾¡ãªã‚¨ãƒƒã‚¸ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ (`PriceClass_100`) ã‚’ä½¿ç”¨
- é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœŸé–“ã‚’æœ€é©åŒ–
- ä¸è¦ãªãƒªã‚½ãƒ¼ã‚¹ã®å‰Šé™¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆæä¾›

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### å®Ÿè£…æ¸ˆã¿

- HTTPS å¿…é ˆãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
- S3 ãƒã‚±ãƒƒãƒˆã®é©åˆ‡ãªã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- CORS è¨­å®š
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆæœ¬ç•ªç’°å¢ƒï¼‰

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆæœ¬ç•ªç’°å¢ƒï¼‰

- `Strict-Transport-Security`
- `X-Content-Type-Options`
- `X-Frame-Options`
- `Referrer-Policy`

## ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

#### 1. ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¨ãƒ©ãƒ¼

```bash
# AWS èªè¨¼ç¢ºèª
aws sts get-caller-identity --profile shota

# æ¨©é™ç¢ºèª
aws iam get-user --profile shota
```

#### 2. CloudFront ã‚­ãƒ£ãƒƒã‚·ãƒ¥å•é¡Œ

```bash
# ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–
./scripts/deploy.sh invalidate dev
```

#### 3. S3 ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å•é¡Œ

```bash
# S3 ãƒã‚±ãƒƒãƒˆç¢ºèª
aws s3 ls --profile shota

# æ‰‹å‹•åŒæœŸ
./scripts/deploy.sh sync dev
```

### ãƒ­ã‚°ç¢ºèª

```bash
# Serverless ãƒ­ã‚°
sls logs --function main --tail --stage dev

# CloudFormation ã‚¹ã‚¿ãƒƒã‚¯ç¢ºèª
aws cloudformation describe-stacks --stack-name makeoo-frontend-dev --profile shota
```

## ğŸ“Š ç›£è¦–

### CloudWatch ãƒ¡ãƒˆãƒªã‚¯ã‚¹

- CloudFront ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°
- S3 ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä½¿ç”¨é‡
- ã‚¨ãƒ©ãƒ¼ç‡ç›£è¦–

### ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®šï¼ˆå°†æ¥å®Ÿè£…äºˆå®šï¼‰

- ç•°å¸¸ãªãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯å¢—åŠ 
- ã‚¨ãƒ©ãƒ¼ç‡ä¸Šæ˜‡
- ã‚³ã‚¹ãƒˆå¢—åŠ 

## ğŸ”„ CI/CD çµ±åˆï¼ˆå°†æ¥å®Ÿè£…äºˆå®šï¼‰

```yaml
# GitHub Actions ä¾‹
name: Deploy to AWS
on:
  push:
    branches: [main]
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
      - run: cd infra && npm install
      - run: ./infra/scripts/deploy.sh deploy prod
```

## ğŸ“ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

- `serverless.yml`: ãƒ¡ã‚¤ãƒ³è¨­å®š
- `config/serverless.dev.yml`: é–‹ç™ºç’°å¢ƒè¨­å®š
- `config/serverless.prod.yml`: æœ¬ç•ªç’°å¢ƒè¨­å®š
- `package.json`: ä¾å­˜é–¢ä¿‚ã¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

## ğŸ¯ ä»Šå¾Œã®æ”¹å–„äºˆå®š

- [ ] ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³å¯¾å¿œï¼ˆRoute53 + ACMï¼‰
- [ ] GitHub Actions CI/CD çµ±åˆ
- [ ] ç’°å¢ƒå¤‰æ•°ç®¡ç†ï¼ˆAWS Systems Managerï¼‰
- [ ] ãƒ­ã‚°åˆ†æï¼ˆCloudWatch Logs Insightsï¼‰
- [ ] ã‚³ã‚¹ãƒˆç›£è¦–ã‚¢ãƒ©ãƒ¼ãƒˆ
- [ ] Blue/Green ãƒ‡ãƒ—ãƒ­ã‚¤
